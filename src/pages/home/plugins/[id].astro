---
import AddPlugin from '@components/home/addPlugin';
import GeneralSideBar from '@components/home/GeneralSideBar.astro';
import DashboardLayout from '@layouts/DashboardLayout.astro';
import { plugins } from '@lib/plugins';

const { user } = Astro.locals;
const user_sections = Object.keys(user.plugins);
const { id } = Astro.params;
const plugin = plugins[id ?? ''];

if (!plugin) return Astro.redirect('/home/plugins/');

const {
	name,
	icon,
	storage_group,
	default_storage,
	documentation,
	version,
	extension_group,
} = plugin;
const Documentacion = await import(
	/* @vite-ignore */ `../../../plugins/${documentation}`
);
---

<DashboardLayout>
	<div slot="content" class="w-full h-full flex flex-col gap-4 p-4">
		<header class="flex justify-between">
			<div class="flex items-center gap-4">
				<img src={`/icons/${icon}`} alt={name} class="w-12 h-12" />
				<h1 class="text-3xl font-bold">
					{name}
					{
						!!version && (
							<small class="text-neutral-500 text-lg">v{version}</small>
						)
					}
				</h1>
			</div>
			<AddPlugin
				id={plugin.id}
				storage_group={storage_group}
				default_storage={default_storage}
				user_sections={user_sections}
				plugins={user.plugins}
			/>
		</header>
		<div>
			<h2 class="text-2xl font-bold">Descripcion</h2>
			<p class="text-lg">{plugin.description}</p>
			{
				!!extension_group && (
					<span class="text-xs py-2 badge badge-outline badge-accent">
						{extension_group}
					</span>
				)
			}
		</div>
		<span class="divider m-0 h-0"></span>
		<main id="doc-small-content-wrapper" >
			<Documentacion.default />
		</main>
	</div>
	<GeneralSideBar
		slot="sidebar"
		main_links={[
			['Dashboard', '/home/dashboard/'],
			['Plugins', '/home/plugins/'],
			['Settings', '/home/settings/'],
			['Documentacion', '/docs/001_intro/'],
		]}
	/>
</DashboardLayout>
